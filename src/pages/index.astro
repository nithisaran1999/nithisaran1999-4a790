---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Nithisaran | Full Stack Developer">
    <section class="tui-window">
        <div class="tui-titlebar">
            <p class="inline-flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                    <rect x="3" y="4" width="18" height="16" rx="2"></rect>
                    <path d="m7 9 3 3-3 3"></path>
                    <path d="M13 15h4"></path>
                </svg>
                portfolio.sh
            </p>
            <p class="text-blue-300">
                <span class="lang-en">status: online</span>
                <span class="lang-th">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</span>
            </p>
        </div>

        <div class="grid gap-4 p-5 sm:p-8">
            <div class="tui-panel">
                <div class="grid items-center gap-5 sm:grid-cols-[140px_1fr]">
                    <img
                        src="/images/profile-avatar.png"
                        alt="Profile picture"
                        width="140"
                        height="140"
                        class="w-[110px] h-[110px] sm:w-[140px] sm:h-[140px] rounded-md border border-blue-600/80 bg-blue-950/50"
                    />
                    <div>
                        <p class="mb-2 font-mono text-sm text-blue-300">$ whoami</p>
                        <h1 class="mb-2 text-blue-50">Nithisaran</h1>
                        <p class="mb-2 text-blue-300">
                            <span class="lang-en">Full Stack Developer</span>
                            <span class="lang-th">‡∏ô‡∏±‡∏Å‡∏û‡∏±‡∏í‡∏ô‡∏≤ Full Stack</span>
                        </p>
                        <p class="max-w-3xl text-blue-100">
                            <span class="lang-en">
                                I am Nithisaran, a Full Stack Developer based in Thailand.
                                I build reliable web applications from frontend interfaces to backend APIs and deployment pipelines.
                                My focus is clean architecture, scalable systems, and fast user experiences.
                            </span>
                            <span class="lang-th">
                                ‡∏ú‡∏°‡∏ä‡∏∑‡πà‡∏≠ Nithisaran ‡πÄ‡∏õ‡πá‡∏ô‡∏ô‡∏±‡∏Å‡∏û‡∏±‡∏í‡∏ô‡∏≤ Full Stack ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢
                                ‡∏ú‡∏°‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏£‡∏ö‡∏ß‡∏á‡∏à‡∏£‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏õ‡∏à‡∏ô‡∏ñ‡∏∂‡∏á API ‡∏ù‡∏±‡πà‡∏á‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏ö deploy
                                ‡πÇ‡∏î‡∏¢‡πÄ‡∏ô‡πâ‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏î‡∏µ ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ ‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß
                            </span>
                        </p>
                    </div>
                </div>
            </div>

            <div id="about" class="tui-panel">
                <p class="mb-2 font-mono text-sm text-blue-300">$ cat about.txt</p>
                <p class="text-blue-100">
                    <span class="lang-en">
                        I work across both frontend and backend systems, delivering complete products from idea to production.
                        My frontend experience includes React and Angular, and my backend experience includes Django and Spring Boot.
                        I also have hands-on experience with Google Firebase, including authentication (login) and database integration.
                    </span>
                    <span class="lang-th">
                        ‡∏ú‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏ù‡∏±‡πà‡∏á frontend ‡πÅ‡∏•‡∏∞ backend ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå‡πÑ‡∏î‡πâ‡∏Ñ‡∏£‡∏ö‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î‡∏à‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏£‡∏¥‡∏á
                        ‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ù‡∏±‡πà‡∏á frontend ‡∏Ñ‡∏∑‡∏≠ React ‡πÅ‡∏•‡∏∞ Angular ‡∏™‡πà‡∏ß‡∏ô backend ‡∏Ñ‡∏∑‡∏≠ Django ‡πÅ‡∏•‡∏∞ Spring Boot
                        ‡∏£‡∏ß‡∏°‡∏ñ‡∏∂‡∏á‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Google Firebase ‡∏ó‡∏±‡πâ‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                    </span>
                </p>
            </div>

            <div id="skills" class="tui-panel">
                <p class="mb-3 font-mono text-sm text-blue-300">$ ls skills/</p>
                <div class="grid gap-3 sm:grid-cols-2">
                    <p class="inline-flex items-center gap-2">
                        <span aria-hidden="true">üñ•Ô∏è</span>
                        <span><span class="tui-kbd">Frontend</span> React, Angular, Astro, Tailwind CSS</span>
                    </p>
                    <p class="inline-flex items-center gap-2">
                        <span aria-hidden="true">‚öôÔ∏è</span>
                        <span><span class="tui-kbd">Backend</span> Django, Spring Boot, REST APIs</span>
                    </p>
                    <p class="inline-flex items-center gap-2">
                        <span aria-hidden="true">‚òÅÔ∏è</span>
                        <span>
                        <span class="tui-kbd lang-en">Cloud DB</span>
                        <span class="tui-kbd lang-th">‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏•‡∏≤‡∏ß‡∏î‡πå</span>
                        Google Firebase (Auth + Database)
                        </span>
                    </p>
                    <p class="inline-flex items-center gap-2">
                        <span aria-hidden="true">üêß</span>
                        <span>
                        <span class="tui-kbd lang-en">Tools</span>
                        <span class="tui-kbd lang-th">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠</span>
                        Git, CI/CD, Docker, Linux
                        </span>
                    </p>
                </div>
            </div>

            <div id="experience" class="tui-panel">
                <p class="mb-3 font-mono text-sm text-blue-300">$ cat experience.log</p>
                <div class="grid gap-3">
                    <article class="p-4 border rounded border-blue-700/70 bg-blue-950/35">
                        <p class="text-xs text-blue-300">2021 | Internship | Chiang Mai, Thailand</p>
                        <h2 class="mt-1 mb-2 text-lg text-blue-50">Intern ‚Ä¢ 4Xtreme</h2>
                        <p class="text-sm text-blue-100">
                            <span class="lang-en">
                                Completed internship at
                                <a href="https://www.4xtreme.com/" target="_blank" rel="noreferrer" class="text-blue-300">4Xtreme</a>
                                in Chiang Mai, Thailand. I worked on frontend tasks using Entity Framework.
                            </span>
                            <span class="lang-th">
                                ‡∏ù‡∏∂‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà
                                <a href="https://www.4xtreme.com/" target="_blank" rel="noreferrer" class="text-blue-300">4Xtreme</a>
                                ‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà ‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢ ‡πÇ‡∏î‡∏¢‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏î‡πâ‡∏≤‡∏ô frontend ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Entity Framework
                            </span>
                        </p>
                    </article>
                    <article class="p-4 border rounded border-blue-700/70 bg-blue-950/35">
                        <p class="text-xs text-blue-300">2024 - Present | Bangkok, Thailand</p>
                        <h2 class="mt-1 mb-2 text-lg text-blue-50">Full Stack Developer ‚Ä¢ 1008Bit Company</h2>
                        <p class="text-sm text-blue-100">
                            <span class="lang-en">
                                At 1008Bit Company, I develop and maintain business web platforms using React and Angular on frontend,
                                with Django and Spring Boot services on backend. Built reusable API modules and release workflows
                                that reduced deployment time for feature updates.
                            </span>
                            <span class="lang-th">
                                ‡∏ó‡∏µ‡πà 1008Bit Company ‡∏ú‡∏°‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÅ‡∏•‡∏∞‡∏î‡∏π‡πÅ‡∏•‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏ß‡πá‡∏ö‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ React ‡πÅ‡∏•‡∏∞ Angular ‡∏ù‡∏±‡πà‡∏á frontend
                                ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ Django ‡∏Å‡∏±‡∏ö Spring Boot ‡∏ù‡∏±‡πà‡∏á backend ‡∏£‡∏ß‡∏°‡∏ñ‡∏∂‡∏á‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÇ‡∏°‡∏î‡∏π‡∏• API ‡∏ó‡∏µ‡πà‡∏ô‡∏≥‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ
                                ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡πà‡∏ß‡∏¢‡∏•‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà
                            </span>
                        </p>
                    </article>
                </div>
            </div>

            <div id="contact" class="tui-panel">
                <p class="mb-2 font-mono text-sm text-blue-300">$ ./contact.sh</p>
                <p class="text-blue-100">
                    <span class="lang-en"><del>Open to full-time, freelance, and contract opportunities.</del> <strong>Hired.</strong></span>
                    <span class="lang-th"><del>‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥ ‡∏á‡∏≤‡∏ô‡∏ü‡∏£‡∏µ‡πÅ‡∏•‡∏ô‡∏ã‡πå ‡πÅ‡∏•‡∏∞‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏à‡πâ‡∏≤‡∏á</del> <strong>‡πÑ‡∏î‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß</strong></span>
                </p>
                <div class="mt-3 flex flex-wrap gap-3">
                    <a href="mailto:nithisaran1999@gmail.com" class="btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                            <rect x="3" y="5" width="18" height="14" rx="2"></rect>
                            <path d="m3 7 9 6 9-6"></path>
                        </svg>
                        <span class="lang-en">Send Email</span>
                        <span class="lang-th">‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•</span>
                    </a>
                    <button id="downloadCvEnBtn" type="button" class="btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                            <path d="M12 3v12"></path>
                            <path d="m7 10 5 5 5-5"></path>
                            <path d="M5 21h14"></path>
                        </svg>
                        <span>Download CV EN</span>
                    </button>
                    <button id="downloadCvThBtn" type="button" class="btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                            <path d="M12 3v12"></path>
                            <path d="m7 10 5 5 5-5"></path>
                            <path d="M5 21h14"></path>
                        </svg>
                        <span>‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î CV TH</span>
                    </button>
                </div>
            </div>
        </div>
    </section>
</Layout>

<script>
    import { jsPDF } from 'jspdf';
    import html2canvas from 'html2canvas';

    const cleanText = (value) => value.replace(/\s+/g, ' ').trim();
    const removeIcons = (value) => cleanText(value.replace(/[üñ•Ô∏è‚öôÔ∏è‚òÅÔ∏èüêß‚óâ‚åÅ‚ñ¶‚åò‚úâ]/gu, ''));
    const escapeHtml = (value) =>
        value
            .replaceAll('&', '&amp;')
            .replaceAll('<', '&lt;')
            .replaceAll('>', '&gt;')
            .replaceAll('"', '&quot;')
            .replaceAll("'", '&#39;');

    const getLocalizedText = (element, lang) => {
        const localizedElement = element.querySelector(`.lang-${lang}`);
        if (localizedElement) {
            return cleanText(localizedElement.textContent || '');
        }

        return cleanText(element.textContent || '');
    };

    const buildCvData = (lang) => {
        const name = cleanText(document.querySelector('h1')?.textContent || 'Nithisaran');
        const role = getLocalizedText(document.querySelector('h1 + p') || document.body, lang);
        const summary = getLocalizedText(document.querySelector('h1 + p + p') || document.body, lang);

        const about = getLocalizedText(document.querySelector('#about .text-blue-100') || document.body, lang);

        const skillItemsByLang = {
            en: [
                'Frontend: React, Angular, Astro, Tailwind CSS',
                'Backend: Django, Spring Boot, REST APIs',
                'Cloud DB: Google Firebase (Auth + Database)',
                'Tools: Git, CI/CD, Docker, Linux'
            ],
            th: [
                'Frontend: React, Angular, Astro, Tailwind CSS',
                'Backend: Django, Spring Boot, REST APIs',
                '‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏•‡∏≤‡∏ß‡∏î‡πå: Google Firebase (Auth + Database)',
                '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠: Git, CI/CD, Docker, Linux'
            ]
        };

        const skillItems = skillItemsByLang[lang];

        const experienceItems = [...document.querySelectorAll('#experience article')].map((article) => {
            const title = removeIcons(article.querySelector('h2')?.textContent || '');
            const period = cleanText(article.querySelector('p')?.textContent || '');
            const details = removeIcons(getLocalizedText(article.querySelector('.text-blue-100') || article, lang));
            return { period, title, details };
        });

        const labels = {
            en: {
                title: 'Curriculum Vitae',
                profile: 'Profile',
                professionalSummary: 'Professional Summary',
                coreCompetencies: 'Core Competencies',
                experience: 'Professional Experience',
                additional: 'Additional Highlights'
            },
            th: {
                title: '‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß (CV)',
                profile: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß',
                professionalSummary: '‡∏™‡∏£‡∏∏‡∏õ‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ß‡∏¥‡∏ä‡∏≤‡∏ä‡∏µ‡∏û',
                coreCompetencies: '‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏´‡∏•‡∏±‡∏Å',
                experience: '‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô',
                additional: '‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°'
            }
        };

        const formalHighlights = {
            en: [
                'Designs and delivers end-to-end web solutions from UI implementation to backend services.',
                'Builds maintainable APIs and supports deployment workflows for reliable production releases.',
                'Collaborates effectively in cross-functional teams and adapts quickly to project requirements.'
            ],
            th: [
                '‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏£‡∏ö‡∏ß‡∏á‡∏à‡∏£‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏à‡∏ô‡∏ñ‡∏∂‡∏á‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ù‡∏±‡πà‡∏á‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå',
                '‡∏û‡∏±‡∏í‡∏ô‡∏≤ API ‡∏ó‡∏µ‡πà‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£ deploy ‡πÉ‡∏´‡πâ‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏£‡∏¥‡∏á',
                '‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡∏°‡∏Ç‡πâ‡∏≤‡∏°‡∏™‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏î‡∏µ‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß'
            ]
        };

        const profileImageSrc = document.querySelector('img[alt="Profile picture"]')?.getAttribute('src') || '/images/profile-avatar.png';

        return {
            name,
            role,
            summary,
            about,
            skillItems,
            experienceItems,
            labels: labels[lang],
            formalHighlights: formalHighlights[lang],
            profileImageSrc
        };
    };

    const resolveImageAsDataUrl = async (src) => {
        if (!src) return '';

        try {
            const response = await fetch(src);
            const blob = await response.blob();

            return await new Promise((resolve) => {
                const reader = new FileReader();
                reader.onloadend = () => resolve(typeof reader.result === 'string' ? reader.result : '');
                reader.readAsDataURL(blob);
            });
        } catch {
            return src;
        }
    };

    const createCvElement = async (lang) => {
        const data = buildCvData(lang);
        const imageDataUrl = await resolveImageAsDataUrl(data.profileImageSrc);
        const container = document.createElement('div');

        container.style.position = 'fixed';
        container.style.left = '-99999px';
        container.style.top = '0';
        container.style.width = '794px';
        container.style.padding = '36px';
        container.style.background = '#ffffff';
        container.style.color = '#111827';
        container.style.fontFamily = "Arial, 'Noto Sans Thai', sans-serif";
        container.style.fontSize = '14px';
        container.style.lineHeight = '1.6';
        container.style.zIndex = '-1';

        container.innerHTML = `
            <div style="display:flex;align-items:flex-start;gap:20px;margin-bottom:18px;">
                <img src="${escapeHtml(imageDataUrl)}" alt="Profile" style="width:92px;height:92px;border-radius:10px;object-fit:cover;border:2px solid #1d4ed8;" />
                <div>
                    <h1 style="margin:0 0 4px 0;font-size:28px;color:#111827;">${escapeHtml(data.name)}</h1>
                    <p style="margin:0 0 4px 0;color:#1e40af;font-size:16px;font-weight:600;">${escapeHtml(data.role)}</p>
                    <p style="margin:0;color:#374151;font-size:13px;">${escapeHtml(data.labels.title)}</p>
                </div>
            </div>

            <h2 style="margin:0 0 8px 0;font-size:18px;color:#1f2937;">${escapeHtml(data.labels.profile)}</h2>
            <p style="margin:0 0 14px 0;">${escapeHtml(data.about)}</p>

            <h2 style="margin:0 0 8px 0;font-size:18px;color:#1f2937;">${escapeHtml(data.labels.professionalSummary)}</h2>
            <p style="margin:0 0 14px 0;">${escapeHtml(data.summary)}</p>

            <h2 style="margin:0 0 8px 0;font-size:18px;color:#1f2937;">${escapeHtml(data.labels.coreCompetencies)}</h2>
            <ul style="margin:0 0 16px 20px;padding:0;">
                ${data.skillItems.map((item) => `<li style="margin:0 0 6px 0;">${escapeHtml(item)}</li>`).join('')}
            </ul>

            <h2 style="margin:0 0 8px 0;font-size:18px;color:#1f2937;">${escapeHtml(data.labels.experience)}</h2>
            <ul style="margin:0 0 16px 20px;padding:0;">
                ${data.experienceItems
                    .map(
                        (item) =>
                            `<li style="margin:0 0 10px 0;"><strong>${escapeHtml(item.title)}</strong><br/><span style="color:#374151;">${escapeHtml(item.period)}</span><br/>${escapeHtml(item.details)}</li>`
                    )
                    .join('')}
            </ul>

            <h2 style="margin:0 0 8px 0;font-size:18px;color:#1f2937;">${escapeHtml(data.labels.additional)}</h2>
            <ul style="margin:0 0 0 20px;padding:0;">
                ${data.formalHighlights.map((item) => `<li style="margin:0 0 6px 0;">${escapeHtml(item)}</li>`).join('')}
            </ul>
        `;

        document.body.appendChild(container);
        return container;
    };

    const exportCvPdf = async (lang) => {
        const container = await createCvElement(lang);

        const canvas = await html2canvas(container, {
            scale: 2,
            useCORS: true,
            backgroundColor: '#ffffff',
            allowTaint: true
        });

        document.body.removeChild(container);

        const documentPdf = new jsPDF({ unit: 'pt', format: 'a4' });
        const pageWidth = documentPdf.internal.pageSize.getWidth();
        const pageHeight = documentPdf.internal.pageSize.getHeight();
        const margin = 24;
        const imageWidth = pageWidth - margin * 2;
        const imageHeight = (canvas.height * imageWidth) / canvas.width;
        const imageData = canvas.toDataURL('image/png');

        let remainingHeight = imageHeight;
        let yPosition = margin;

        documentPdf.addImage(imageData, 'PNG', margin, yPosition, imageWidth, imageHeight);
        remainingHeight -= pageHeight - margin * 2;

        while (remainingHeight > 0) {
            documentPdf.addPage();
            yPosition = margin - (imageHeight - remainingHeight);
            documentPdf.addImage(imageData, 'PNG', margin, yPosition, imageWidth, imageHeight);
            remainingHeight -= pageHeight - margin * 2;
        }

        const filename = lang === 'th' ? 'Nithisaran-CV-TH.pdf' : 'Nithisaran-CV-EN.pdf';
        documentPdf.save(filename);
    };

    const downloadCvEnButton = document.getElementById('downloadCvEnBtn');
    const downloadCvThButton = document.getElementById('downloadCvThBtn');

    downloadCvEnButton?.addEventListener('click', async () => {
        await exportCvPdf('en');
    });

    downloadCvThButton?.addEventListener('click', async () => {
        await exportCvPdf('th');
    });
</script>
