---
const navItems = [
    { linkTextEn: 'About', linkTextTh: 'เกี่ยวกับ', href: '#about', iconClass: 'fa-regular fa-user' },
    { linkTextEn: 'Skills', linkTextTh: 'ทักษะ', href: '#skills', iconClass: 'fa-solid fa-screwdriver-wrench' },
    { linkTextEn: 'Experience', linkTextTh: 'ประสบการณ์', href: '#experience', iconClass: 'fa-solid fa-briefcase' },
    { linkTextEn: 'Contact', linkTextTh: 'ติดต่อ', href: '#contact', iconClass: 'fa-regular fa-envelope' }
];
---

<nav class="flex flex-wrap items-center justify-between gap-2 pt-2 pb-4 sm:gap-4 sm:pt-5 sm:pb-6">
    <a href="/" class="inline-flex items-center gap-2 font-mono text-xs sm:text-base tracking-wide text-blue-100 no-underline">
        <i class="fa-solid fa-terminal text-blue-300" aria-hidden="true"></i>
        <span><span class="text-blue-400">root</span>@portfolio:~$</span>
    </a>
    <button
        id="mobileMenuToggle"
        type="button"
        class="inline-flex items-center justify-center w-9 h-9 text-blue-100 border rounded sm:hidden border-blue-600/70 bg-blue-950/35"
        aria-label="Toggle menu"
        aria-controls="mobileMenu"
        aria-expanded="false"
    >
        <i class="fa-solid fa-bars" aria-hidden="true"></i>
    </button>
    {
        (
            <div
                id="mobileMenu"
                class="hidden w-full p-2 border rounded-md border-blue-700/70 bg-blue-950/25 sm:p-0 sm:border-0 sm:bg-transparent sm:rounded-none sm:w-auto sm:flex sm:flex-row sm:flex-wrap sm:items-center sm:gap-3"
            >
                {!!navItems?.length && (
                    <ul class="flex flex-col gap-1 sm:flex-row sm:flex-wrap sm:gap-x-4 sm:gap-y-1">
                        {navItems.map((item) => (
                            <li>
                                <a
                                    href={item.href}
                                    class="inline-flex w-full items-center gap-1 px-2 py-1.5 text-xs font-medium text-blue-100 no-underline border border-blue-800/60 rounded sm:w-auto sm:gap-1.5 sm:px-2 sm:py-1 sm:text-sm hover:border-blue-600/70 hover:bg-blue-950/30"
                                    data-nav-link
                                >
                                    <i class:list={[item.iconClass, 'text-blue-300']} aria-hidden="true" />
                                    <span class="lang-en">{item.linkTextEn}</span>
                                    <span class="lang-th">{item.linkTextTh}</span>
                                </a>
                            </li>
                        ))}
                    </ul>
                )}

                <div class="lang-switcher mt-1 self-start sm:mt-0 sm:self-auto" role="group" aria-label="Language switcher">
                    <button class="lang-switch-btn" type="button" data-set-lang="en">
                        EN
                    </button>
                    <button class="lang-switch-btn" type="button" data-set-lang="th">
                        TH
                    </button>
                </div>

                <div class="theme-switcher mt-1 self-start sm:mt-0 sm:self-auto" role="group" aria-label="Theme switcher">
                    <button class="theme-switch-btn" type="button" data-set-theme="dark">
                        Dark
                    </button>
                    <button class="theme-switch-btn" type="button" data-set-theme="light">
                        Light
                    </button>
                    <button class="theme-switch-btn" type="button" data-set-theme="system">
                        System
                    </button>
                </div>
            </div>
        )
    }
</nav>

<script is:inline>
    (() => {
        const docEl = document.documentElement;
        const themeMedia = window.matchMedia('(prefers-color-scheme: dark)');
        const mobileMenu = document.getElementById('mobileMenu');
        const mobileMenuToggle = document.getElementById('mobileMenuToggle');

        const setMenuState = (expanded) => {
            if (!mobileMenu || !mobileMenuToggle) return;
            mobileMenu.classList.toggle('hidden', !expanded);
            mobileMenuToggle.setAttribute('aria-expanded', expanded ? 'true' : 'false');
            mobileMenuToggle.innerHTML = expanded
                ? '<i class="fa-solid fa-xmark" aria-hidden="true"></i>'
                : '<i class="fa-solid fa-bars" aria-hidden="true"></i>';
        };

        mobileMenuToggle?.addEventListener('click', () => {
            const expanded = mobileMenuToggle.getAttribute('aria-expanded') === 'true';
            setMenuState(!expanded);
        });

        document.querySelectorAll('[data-nav-link]').forEach((link) => {
            link.addEventListener('click', () => {
                if (window.innerWidth < 640) {
                    setMenuState(false);
                }
            });
        });

        const applyLang = (lang) => {
            const next = lang === 'th' ? 'th' : 'en';
            docEl.setAttribute('data-lang', next);
            docEl.setAttribute('lang', next);
            localStorage.setItem('portfolio-lang', next);
        };

        const storedLang = localStorage.getItem('portfolio-lang');
        if (storedLang) {
            applyLang(storedLang);
        }

        document.querySelectorAll('[data-set-lang]').forEach((button) => {
            button.addEventListener('click', () => {
                applyLang(button.getAttribute('data-set-lang') || 'en');
            });
        });

        const resolveThemePreference = (value) => {
            if (value === 'dark' || value === 'light' || value === 'system') {
                return value;
            }

            return 'system';
        };

        const applyThemePreference = (preference) => {
            const nextPreference = resolveThemePreference(preference);
            const nextTheme = nextPreference === 'system' ? (themeMedia.matches ? 'dark' : 'light') : nextPreference;

            docEl.setAttribute('data-theme-pref', nextPreference);
            docEl.setAttribute('data-theme', nextTheme);
            localStorage.setItem('portfolio-theme', nextPreference);
        };

        applyThemePreference(resolveThemePreference(localStorage.getItem('portfolio-theme')));

        document.querySelectorAll('[data-set-theme]').forEach((button) => {
            button.addEventListener('click', () => {
                applyThemePreference(button.getAttribute('data-set-theme') || 'system');
            });
        });

        if (typeof themeMedia.addEventListener === 'function') {
            themeMedia.addEventListener('change', () => {
                if (resolveThemePreference(docEl.getAttribute('data-theme-pref')) === 'system') {
                    applyThemePreference('system');
                }
            });
        } else if (typeof themeMedia.addListener === 'function') {
            themeMedia.addListener(() => {
                if (resolveThemePreference(docEl.getAttribute('data-theme-pref')) === 'system') {
                    applyThemePreference('system');
                }
            });
        }
    })();
</script>
